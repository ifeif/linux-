VPN(Virtual Private Network) 虚拟专用网络：
在公网中建立自己的虚拟专用网络通道，采用"隧道"技术，对原始数据包进行二次封装，实现点对点连接。
VPN服务器采用双网卡结构，外网卡使用公网IP访问外网，内网卡连接局域网。
VPN本质上是外网VPN客户端与内网VPN服务器建立通信隧道，使用IP-in-IP封装后在隧道中转发数据包。
为了保证保密性，VPN服务器还采用"加密"技术把内网IP数据包加密后，封装为外网IP数据包在外网传输。

常见的隧道协议有：PPTP、L2TP/IPSec、SSLVPN。
其中PPTP和L2TP/IPSec都依赖原来点对点协议(PPP)对数据进行封装。
PPP原来是利用串口建立物理连接来实现拨号连接或专用的点对点连接。
PPP数据包封装了IP数据包，属于数据链路层协议。

隧道技术：
是通过一种协议传送另外一种协议的技术，隧道协议利用附加的报头封装帧，
附加的报头提供了路由信息，因此封装后的包能够通过中间的公网。
封装后的包所途经的公网的逻辑路径称为隧道。
一旦封装的帧到达了公网上的目的地，帧就会被解除封装并被继续送到最终目的地。

为了模拟点对点(p2p)链路，VPN使用隧道协议来封装数据。
其基本思路是把一个数据包封装在另一个数据包中，就像把写有地址的一封信装在另一封信中一样。
外部数据包的包头提供路由信息，使数据可以通过公网到达其终点。
为了保证数据在公网上的传输安全，对所发送的数据进行加密。封装并加密专用数据的链路称为VPN连接。

PPTP协议：基于点对点(PPP)协议，使用PAP或CHAP加密协议，或者使用微软的加密算法MPPE。还包含链路控制协议(LCP)、网络控制协议(NCP)。
PPTP封装：原IP数据包的最外层封装着IP标头，PPTP数据包为了在公网上传输，最外层也封装着IP标头。
使用TCP连接进行管理，使用通用路由封装协议(GRE)来封装PPP帧，PPP帧负载的数据包可以加密或压缩。
PPTP数据包的结构：
	IP标头 | GRE标头 | PPP标头 | PPP负载(原IP数据包)

L2TP协议：支持在两端点间使用多隧道，可以提供隧道验证，而PPTP则不支持隧道验证。
L2TP不使用MPPE对负载进行加密，而依靠IPSec安全协议进行加密。
L2TP封装：在原有PPP数据包的基础上封装，包含IP标头、UDP标头、L2TP标头。
L2TP数据包结构：
	IP标头 | UDP标头 | L2TP标头 | PPP标头 | PPP负载(原IP数据包)
IPSec协议：允许对原数据包进行加密，然后封装在IP包头中。
IPSec数据包结构：
	IP标头 | IPSec ESP标头 | UDP标头 | L2TP标头 | PPP标头 | PPP负载(原IP数据包) | IPSec ESP尾端 | IPSec身份验证尾端
			    |------------------由IPSec加密------------------------|
VPN数据包抽象：
	ndst | nsrc | dst | src | data
nsrc和ndst是隧道端点设备的ip地址
在公网传输考虑ndst和nsrc
在内网传输考虑dst和src

远程访问VPN：
又称为拨号VPN(即VPDN),VPN客户端通过向VPN服务器验证或拨号建立虚拟专用网络。获取到的内网IP地址的子网掩码一般为255.255.255.555。
两个内网建立VPN：
在两个内网之间搭建两台VPN服务器，两台VPN服务器接上公网，两个内网通过这两台VPN服务器建立的隧道进行连接。
